;=========================================================
; 文件名: ex2.ASM
; 功能描述: 利用8255和8259a实现开关控制流水灯
;=========================================================
SSTACK  SEGMENT STACK
DW 32 DUP(32)
SSTACK ENDS

CODE SEGMENT 
ASSUME CS:CODE
START: PUSH DS
MOV DX,0646H
MOV AL,80H
OUT DX,AL
MOV BX,0001H
MOV DX,1

MOV AX,0000H
MOV DS,AX
MOV AX,OFFSET MIR7
MOV SI,003CH
MOV [SI],AX
MOV AX,CS
MOV SI,003EH
MOV [SI],AX

MOV AX,OFFSET SIR1
MOV SI,00C4H
MOV [SI],AX
MOV AX,CS
MOV SI,00C6H
MOV [SI],AX
CLI
POP DS

MOV AL,11H
OUT 20H,AL
MOV AL,08H
OUT 21H,AL
MOV AL,04H
OUT 21H,AL
MOV AL,01H
OUT 21H,AL

MOV AL,11H
OUT 0A0H,AL
MOV AL,30H
OUT 0A1H,AL
MOV AL,02H
OUT 0A1H,AL
MOV AL,01H
OUT 0A1H,AL
MOV AL,0FDH
OUT 0A1H,AL
MOV AL,6BH
OUT 21H,AL
STI

AA2: CMP DX,0
NOP
JE AA2
CLI
PUSH DX

MOV DX,0640H
MOV AL,BL
OUT DX,AL
MOV DX,0642H
MOV AL,BH
OUT DX,AL
CALL DELAY
CALL DELAY
ROL BX,1
POP DX
STI
LOOP AA2

MIR7: CALL DELAY
MOV DX,0
MOV AL,20H
OUT 20H,AL
IRET

SIR1: CALL DELAY
MOV DX,1
MOV AL,20H
OUT 0A0H,AL
OUT 20H,AL
IRET